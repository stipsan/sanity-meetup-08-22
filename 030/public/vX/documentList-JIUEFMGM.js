import{A as ce,Aa as Y,B as le,C as ue,D as me,E as de,Ea as Me,J as pe,L as fe,M as at,P as D,Q as O,R as $,S as ye,T as M,U as w,V as ge,W as V,X as he,Y as Ee,Z as Ie,aa as Le,b as v,ba as ct,ca as Te,da as k,ea as Re,f as j,h as z,i as X,ia as Pe,j as Q,ja as Se,ka as xe,l as J,m as A,ma as _e,n as G,na as N,o as Z,oa as Ce,pa as ve,q as ee,qa as De,r as te,ra as be,s as ne,sa as Fe,t as re,ta as Ae,u as oe,ua as Oe,v as ie,w as H,wa as we,x as se,xa as je,y as ae,ya as $e}from"./chunk-ALQ4RA6M.js";var f=v(j());var Qe=v(ct());var q={by:[{field:"_createdAt",direction:"desc"}]},ke={};function Ne(e,t){return e._id?k(e._id):"item-".concat(t)}function qe(e){return Re(e).map(t=>({...t.draft||t.published,hasPublished:!!t.published,hasDraft:!!t.draft}))}var lt=/\b_type\s*==\s*(['"].*?['"]|\$.*?(?:\s|$))|\B(['"].*?['"]|\$.*?(?:\s|$))\s*==\s*_type\b/;function Be(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.match(lt);if(!n)return null;let r=(n[1]||n[2]).trim().replace(/^["']|["']$/g,"");if(r[0]==="$"){let s=r.slice(1),u=t[s];return typeof u=="string"?u:null}return r}function Ue(e){return/^_type\s*==\s*['"$]\w+['"]?\s*$/.test(e.trim())}function We(e){return e.map(t=>[ut(t),(t.direction||"").toLowerCase()].map(n=>n.trim()).filter(Boolean).join(" ")).join(",")}function ut(e){return e.mapWith?"".concat(e.mapWith,"(").concat(e.field,")"):e.field}function Ge(e,t){let n=e.by.map(r=>{if(r.mapWith)return r;let s=mt(t,r.field);return s?pt(s,"datetime")?{...r,mapWith:"dateTime"}:s.jsonType==="string"?{...r,mapWith:"lower"}:r:r});return n.every((r,s)=>r===e.by[s])?e:{...e,by:n}}function mt(e,t){let n=xe(t),r=e;for(let s of n){if(!r)return;if(typeof s=="string"){r=dt(r,s);continue}if(!(X(s)||z(s))||r.jsonType!=="array")return;let[o,a]=r.of||[];if(a||!o)return;if(!Q(o)){r=o;continue}let[m,g]=o.to||[];if(g||!m)return;r=m}return r}function dt(e,t){if(!("fields"in e))return;let n=e.fields.find(r=>r.name===t);return n?n.type:void 0}function pt(e,t){let n=e.type;for(;n;){if(n.name===t||!n.type&&n.jsonType===t)return!0;n=n.type}return!1}var i=v(j());function He(e){let{childItemId:t,error:n,filterIsSimpleTypeContraint:r,fullList:s,isActive:u,isLoading:o,items:a,layout:m,onListChange:g,onRetry:d,showIcons:c}=e,L=N(),{collapsed:b}=ve(),{collapsed:E,index:S}=be(),[T,F]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(E)return;let l=setTimeout(()=>{F(!0)},0);return()=>{clearTimeout(l)}},[E]);let x=(0,i.useCallback)(l=>{let I=k(l._id),y=t===I,h=!u&&y,_=u&&y;return i.default.createElement(Me,{icon:c===!1?!1:void 0,id:I,pressed:h,selected:_,layout:m,schemaType:L.get(l._type),value:l})},[t,u,m,L,c]),R=(0,i.useMemo)(()=>{if(!T)return null;if(n)return i.default.createElement($,{align:"center",direction:"column",height:"fill",justify:"center"},i.default.createElement(V,{width:1},i.default.createElement(Ie,{paddingX:4,paddingY:5,space:4},i.default.createElement(he,{as:"h3"},"Could not fetch list items"),i.default.createElement(D,{as:"p"},"Error: ",i.default.createElement("code",null,n.message)),d&&i.default.createElement(O,null,i.default.createElement(M,{icon:fe,onClick:d,text:"Retry",tone:"primary"})))));if(a===null)return i.default.createElement($,{align:"center",direction:"column",height:"fill",justify:"center"},i.default.createElement(je,{ms:300},i.default.createElement(i.default.Fragment,null,i.default.createElement(ye,{muted:!0}),i.default.createElement(O,{marginTop:3},i.default.createElement(D,{align:"center",muted:!0,size:1},"Loading documents\u2026")))));if(!o&&a.length===0)return i.default.createElement($,{align:"center",direction:"column",height:"fill",justify:"center"},i.default.createElement(V,{width:1},i.default.createElement(O,{paddingX:4,paddingY:5},i.default.createElement(D,{align:"center",muted:!0,size:2},r?"No documents of this type":"No matching documents"))));let l=s&&a.length===2e3;return i.default.createElement(O,{padding:2},a.length>0&&i.default.createElement(Ee,{gap:1,getItemKey:Ne,items:a,renderItem:x,onChange:g,key:"".concat(S,"-").concat(E)}),o&&i.default.createElement(w,{borderTop:!0,marginTop:1,paddingX:3,paddingY:4},i.default.createElement(D,{align:"center",muted:!0,size:1},"Loading\u2026")),l&&i.default.createElement(w,{marginTop:1,paddingX:3,paddingY:4,radius:2,tone:"transparent"},i.default.createElement(D,{align:"center",muted:!0,size:1},"Displaying a maximum of ",2e3," documents")))},[n,r,s,g,o,a,d,x,T,E,S]);return i.default.createElement(Fe,{overflow:b?void 0:"auto"},R)}var P=v(j());var K=(0,P.memo)(e=>{let{index:t,initialValueTemplates:n=[],menuItems:r=[],menuItemGroups:s=[],setLayout:u,setSortOrder:o,title:a}=e,{features:m}=we(),g=(0,P.useMemo)(()=>({setLayout:d=>{let{layout:c}=d;u(c)},setSortOrder:d=>{o(d)}}),[u,o]);return P.default.createElement(Ae,{backButton:m.backButton&&t>0&&P.default.createElement(M,{as:$e,"data-as":"a",icon:pe,mode:"bleed"}),title:a,actions:P.default.createElement(Oe,{initialValueTemplateItems:n,actionHandlers:g,menuItemGroups:s,menuItems:r})})});K.displayName="DocumentListPaneHeader";var p=v(j());var Ve=v(at());var ft={result:null,error:!1},yt=e=>({result:{documents:e},loading:!1,error:!1}),gt=e=>({result:null,loading:!1,error:e}),Ye=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=new oe,r=n.next.bind(n);return e.pipe(G(o=>({client:o.client,query:o.query,params:o.params})),te(Ve.default),ce(1),ae()).pipe(me(o=>{let a=Ce(o.client,o.query,o.params,t).pipe(G(yt),le());return H(A({loading:!0}).pipe(ee(400),de(a)),a)})).pipe(ue(ft),J((o,a)=>Z(A(gt(o)),H(Le(window,"online"),n).pipe(re(1),se(a)))),ie((o,a)=>({...o,...a,onRetry:r})))};function ze(e){var t;let{apiVersion:n,defaultOrdering:r,filter:s,params:u,sortOrder:o}=e,a=_e(),[m,g]=(0,p.useState)(!1),d=(0,p.useRef)(m),[c,L]=(0,p.useState)(null),b=c?.error||null,E=c?.loading||c===null,S=c?.onRetry,T=c==null||(t=c.result)===null||t===void 0?void 0:t.documents,F=(0,p.useMemo)(()=>T?qe(T):null,[T]),x=(0,p.useMemo)(()=>{let l=o?.extendedProjection,I=["_id","_type"],y=I.join(","),h=r||o?.by||[],_=m?2e3:100,U=h.length>0?h:q.by,C=We(U);if(l){let W=I.concat(l).join(",");return["*[".concat(s,"] {").concat(W,"}"),"order(".concat(C,") [0...").concat(_,"]"),"{".concat(y,"}")].join("|")}return"*[".concat(s,"]|order(").concat(C,")[0...").concat(_,"]{").concat(y,"}")},[r,s,m,o]),R=(0,p.useCallback)(l=>{let{toIndex:I}=l;E||d.current||I>=100/2&&(g(!0),d.current=!0)},[E]);return(0,p.useEffect)(()=>{let l=m?h=>Boolean(h.result):()=>!0;L(h=>h?{...h,loading:!0}:null);let y=Ye(A({client:a,query:x,params:u}),{apiVersion:n,tag:"desk.document-list"}).pipe(ne(l)).subscribe(L);return()=>y.unsubscribe()},[n,a,m,x,u]),(0,p.useEffect)(()=>{L(null),g(!1),d.current=!1},[s,u,o,n]),{error:b,fullList:m,handleListChange:R,isLoading:E,items:F,onRetry:S}}var Xe=[];function Et(e){let t=(0,f.useRef)(e);return(0,Qe.default)(t.current,e)||(t.current=e),t.current}var It=(0,f.memo)(function(t){let{childItemId:n,index:r,isActive:s,isSelected:u,pane:o,paneKey:a}=t,m=N(),{name:g}=Se(),{defaultLayout:d="default",displayOptions:c,initialValueTemplates:L=Xe,menuItems:b,menuItemGroups:E,options:S,title:T}=o,{apiVersion:F,defaultOrdering:x=Xe,filter:R}=S,l=Et(S.params||ke),I=o.source,y=(0,f.useMemo)(()=>Be(R,l),[R,l]),h=c?.showIcons!==!1,[_,U]=Y(y,"layout",d),[C,W]=Y(y,"sortOrder",q),Je=y&&C?Ge(C,m.get(y)):C,Ze=Te(Je),et=Ue(R),{error:tt,fullList:nt,handleListChange:rt,isLoading:ot,items:it,onRetry:st}=ze({defaultOrdering:x,filter:R,params:l,sortOrder:Ze,apiVersion:F});return f.default.createElement(Pe,{name:I||g},f.default.createElement(De,{currentMaxWidth:350,id:a,maxWidth:640,minWidth:320,selected:u},!1&&f.default.createElement(w,{padding:4,tone:"transparent"},f.default.createElement(ge,null,o.source||"(none)")),f.default.createElement(K,{index:r,initialValueTemplates:L,menuItems:b,menuItemGroups:E,setLayout:U,setSortOrder:W,title:T}),f.default.createElement(He,{childItemId:n,error:tt,filterIsSimpleTypeContraint:et,fullList:nt,isActive:s,isLoading:ot,items:it,layout:_,onListChange:rt,onRetry:st,showIcons:h})))});export{It as default};
//# sourceMappingURL=documentList-JIUEFMGM.js.map
